# Recommended cipher.yml — template created by assistant on 2025-11-13T03:49:45Z
# NOTE: Review/adjust secrets and server commands before use.
# LM routing policy update:
# - Cline now calls OpenRouter directly for all LM requests
# - Cipher remains the MCP server/aggregator for tools only
# - Do NOT route IDE/LM requests through Cipher
agent:
  name: "cipher-agent"
  provider: "openrouter"
  model: "x-ai/grok-4-fast"
  api_key: "${OPENROUTER_API_KEY}"
  base_url: "https://openrouter.ai/api/v1"
  temperature: 0.1
  max_tokens: 2048
  instructions: |
    # Routing rules / system prompt (derived from .kilocode/rules/cipher-routing-rules.md)
    DOMAIN-SPECIFIC-FIRST: true
    routingGuidelines: >
      Always prefer domain-specific MCP tools over generic fallbacks.
      Examples: github (git ops), firecrawl (web scraping), code-index (code analysis),
      schemathesis (API testing), pytest (tests), filesystem (file ops), brave-search (web search),
      httpie (HTTP).
    For tool calls, output JSON with tool_name and arguments per inputSchema.
    Use memoryBank for session recall and workspaceMemory for context.
toolExecution:
  callTimeout: 45000       # global call timeout (ms)
  maxParallelCalls: 1
  maxToolCallsPerTask: 8
workspaceMemory:
  enabled: true
  path: ./data/workspace-memory
  autoCapture: true
memoryBank:
  path: ./data/memory-bank
  routingPatternsPath: ./data/memory-bank/routing-patterns
mcpServers:
  routing-metadata:
    enabled: true
    type: stdio
    command: python3
    args: ["servers/routing-metadata-mcp.py"]
    env:
      OTEL_ENABLED: "false"
  httpie:
    enabled: true
    type: stdio
    command: python3
    args: ["servers/httpie-mcp.py"]
  schemathesis:
    enabled: true
    type: stdio
    command: python3
    args: ["servers/schemathesis-mcp.py"]
  filesystem:
    enabled: true
    type: stdio
    command: python3
    args: ["servers/custom-filesystem-mcp.py"]
  file-batch:
    enabled: true
    type: stdio
    command: python3
    args: ["servers/file-batch-mcp.py"]
  pytest:
    enabled: true
    type: stdio
    command: python3
    args: ["servers/pytest-mcp.py"]
  firecrawl:
    enabled: true
    type: stdio
    command: npx
    args: ["-y", "@brave/firecrawl-mcp-server"]
  code-index:
    enabled: true
    type: stdio
    command: python3
    args: ["servers/code-index-mcp.py"]
  memory-bank:
    enabled: true
    type: stdio
    command: python3
    args: ["servers/memory-bank-mcp.py"]
  logs:
    enabled: true
    type: stdio
    command: python3
    args: ["servers/logs-mcp.py"]
env:
  # These are defaults; secrets should live in .env and be loaded by mcp-manager.sh
  OPENAI_API_KEY: "${OPENAI_API_KEY:-}"
  KNOWLEDGE_GRAPH_ENABLED: "true"
  LOKI_BASE_URL: ""
  OTEL_EXPORTER_OTLP_ENDPOINT: "http://localhost:4317"
notes:
  - "This file is a recommended template. Verify all commands, venv paths, and environment variables before starting the aggregator."
  - "If you want, I can parse this file and store a structured routing summary into memory (servers, timeouts, routing rules)."
  - "LM policy: Cline → OpenRouter direct; Cipher is MCP-only. Enable llm-inference only for non-IDE flows if explicitly required."
